<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Spring Retry Overview</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Spring Retry Overview</h1>
</header>
<section data-field="subtitle" class="p-summary">
In the software world, there is a chance that some part of the code might not work at a given time. In such cases, we might want to re-run…
</section>
<section data-field="body" class="e-content">
<section name="e6ca" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="16e7" id="16e7" class="graf graf--h3 graf--leading graf--title">Spring Retry Overview</h3><figure name="0d7e" id="0d7e" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*Fyzqx2cM9deUKFFG" data-width="5184" data-height="3888" data-unsplash-photo-id="-dChkgNLmp4" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*Fyzqx2cM9deUKFFG"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@brett_jordan?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com/@brett_jordan?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-creator noopener" target="_blank">Brett Jordan</a> on <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-source noopener" target="_blank">Unsplash</a></figcaption></figure><p name="2137" id="2137" class="graf graf--p graf-after--figure">In the software world, there is a chance that some part of the code might not work at a given time. In such cases, we might want to re-run it again. If it did not work after specified retries, we might want to recover any changes done.</p><p name="f478" id="f478" class="graf graf--p graf-after--p graf--trailing">In Springboot, this can be achieved using Spring Retry.</p></div></div></section><section name="aff3" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="202e" id="202e" class="graf graf--p graf--leading">Here, we are using Java 17. To start using the retry mechanism in Spring, we need below dependencies in <code class="markup--code markup--p-code">build.gradle</code> file:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="db3a" id="db3a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">dependencies {<br /> implementation <span class="hljs-string">&#x27;org.springframework.retry:spring-retry:2.0.3&#x27;</span><br /> implementation <span class="hljs-string">&#x27;org.springframework:spring-aspects&#x27;</span><br />}</span></pre><p name="a06b" id="a06b" class="graf graf--p graf-after--pre">And, add annotation <code class="markup--code markup--p-code">@EnableRetry</code> on <code class="markup--code markup--p-code">@Configuration</code> class. By this, the beans with retryable methods will be proxied and the retry handled according to the metadata in the annotations.</p><p name="9a5f" id="9a5f" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Scenario:</strong></p><p name="be1c" id="be1c" class="graf graf--p graf-after--p">Let’s say we want our application to invoke API exposed by another application. If destination service is unavailable at that time, we want to retry connecting to it after a while.</p><p name="a236" id="a236" class="graf graf--p graf-after--p">For the method that needs retry enabled, add <code class="markup--code markup--p-code">@Retryable</code> annotation:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="less" name="466a" id="466a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">    <span class="hljs-variable">@Retryable</span>(retryFor = {ConnectException.class, ResourceAccessException.class},<br />               maxAttempts = <span class="hljs-number">2</span>, backoff = <span class="hljs-variable">@Backoff</span>(value = <span class="hljs-number">2000</span>))<br />    public void <span class="hljs-built_in">testAPIService</span>(String arg1, Integer arg2) throws URISyntaxException, ConnectException {<br />    <span class="hljs-comment">//code to retry...</span><br />    }</span></pre><ul class="postList"><li name="e47f" id="e47f" class="graf graf--li graf-after--pre"><em class="markup--em markup--li-em">retryFor: </em>Include one or more exceptions list to be retried for.</li><li name="b8db" id="b8db" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">maxAttempts: </em>Number of times the method should be retried (default value is 3). Here, the first execution is also considered a retry.</li><li name="801c" id="801c" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">backOff</em> : Details on the delay between each retry. We are waiting for 2000 milliseconds until the next retry.</li></ul><p name="1f27" id="1f27" class="graf graf--p graf-after--li">Create the recover method(s) annotated with <code class="markup--code markup--p-code">@Recover</code> in same class. This method will take exception for which the retry happened as the first parameter and all the other parameters in order after that.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="typescript" name="d392" id="d392" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">    <span class="hljs-meta">@Recover</span><br />    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">recover</span>(<span class="hljs-params">ResourceAccessException ex, <span class="hljs-built_in">String</span> arg1, Integer arg2</span>) {<br />    <span class="hljs-comment">// code to recover</span><br />    }</span></pre><blockquote name="76fd" id="76fd" class="graf graf--blockquote graf-after--pre">Note: There can be many recover methods for different exceptions</blockquote><p name="d893" id="d893" class="graf graf--p graf-after--blockquote">The complete class will look as below:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="java" name="5f7c" id="5f7c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">package</span> com.example.springretryoverview.service;<br /><br /><span class="hljs-keyword">import</span> com.example.springretryoverview.listener.DefaultListenerSupport;<br /><span class="hljs-keyword">import</span> org.slf4j.Logger;<br /><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br /><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br /><span class="hljs-keyword">import</span> org.springframework.http.HttpMethod;<br /><span class="hljs-keyword">import</span> org.springframework.http.RequestEntity;<br /><span class="hljs-keyword">import</span> org.springframework.retry.annotation.Backoff;<br /><span class="hljs-keyword">import</span> org.springframework.retry.annotation.Recover;<br /><span class="hljs-keyword">import</span> org.springframework.retry.annotation.Retryable;<br /><span class="hljs-keyword">import</span> org.springframework.retry.support.RetrySynchronizationManager;<br /><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br /><span class="hljs-keyword">import</span> org.springframework.web.client.ResourceAccessException;<br /><span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;<br /><br /><span class="hljs-keyword">import</span> java.net.ConnectException;<br /><span class="hljs-keyword">import</span> java.net.URI;<br /><span class="hljs-keyword">import</span> java.net.URISyntaxException;<br /><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br /><br /><span class="hljs-meta">@Service</span><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainService</span> {<br /><br />    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(MainService.class);<br /><br />    <span class="hljs-meta">@Autowired</span><br />    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br /><br />    <span class="hljs-comment">/***<br />     * This method called 2 times (including first execution) with gap of 2000 milliseconds between each call.<br />     * And, will call the recover method on 2nd failure<br />     * <span class="hljs-doctag">@throws</span> URISyntaxException<br />     * <span class="hljs-doctag">@throws</span> ConnectException<br />     */</span><br />    <span class="hljs-meta">@Retryable(retryFor = {ConnectException.class, ArithmeticException.class, ResourceAccessException.class}, maxAttempts = 2, backoff = @Backoff(value = 2000))</span><br />    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">testAPIService</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> URISyntaxException, ConnectException {<br />        <span class="hljs-keyword">try</span> {<br />            logger.info(<span class="hljs-string">&quot;Retry Number : &quot;</span> + RetrySynchronizationManager.getContext().getRetryCount()+<span class="hljs-string">&quot; at time:&quot;</span>+ LocalDateTime.now());<br />            RequestEntity&lt;Object&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestEntity</span>&lt;&gt;(HttpMethod.GET, <span class="hljs-keyword">new</span> <span class="hljs-title class_">URI</span>(<span class="hljs-string">&quot;http://localhost:8088/students&quot;</span>));<br />            restTemplate.exchange(request, String.class);<br />            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;calledAPI&quot;</span>;<br />        }<br />        <span class="hljs-keyword">catch</span> (Exception ex) {<br />            logger.info(<span class="hljs-string">&quot;other exception occurred. &quot;</span>+ex.getMessage());<br />            <span class="hljs-keyword">if</span>(ex <span class="hljs-keyword">instanceof</span>  ConnectException) {<br />                logger.info(<span class="hljs-string">&quot;throwing&quot;</span>);<br />                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectException</span>();<br />            }<br />            <span class="hljs-keyword">if</span>(ex <span class="hljs-keyword">instanceof</span> ResourceAccessException) {<br />                logger.info(<span class="hljs-string">&quot;throwing resourceAccessException&quot;</span>);<br />                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceAccessException</span>(ex.getMessage());<br />            }<br />        }<br />        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br />    }<br /><br />    <span class="hljs-meta">@Recover</span><br />    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">recover</span><span class="hljs-params">(ConnectException e)</span> <span class="hljs-keyword">throws</span> URISyntaxException {<br />        logger.info(<span class="hljs-string">&quot;ConnectException recovered at:&quot;</span>+LocalDateTime.now());<br />        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CouldNotCallAPI&quot;</span>;<br />    }<br /><br />    <span class="hljs-meta">@Recover</span><br />    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">recover</span><span class="hljs-params">(ArithmeticException ex)</span> {<br />        logger.info(<span class="hljs-string">&quot;ArithmeticException recovered at:&quot;</span>+LocalDateTime.now());<br />        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CouldNotCallAPI&quot;</span>;<br />    }<br /><br />    <span class="hljs-meta">@Recover</span><br />    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">recover</span><span class="hljs-params">(ResourceAccessException ex)</span> {<br />        logger.info(<span class="hljs-string">&quot;ResourceAccessException recovered at:&quot;</span>+LocalDateTime.now());<br />        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CouldNotCallAPI&quot;</span>;<br />    }<br /><br />}</span></pre><p name="dc31" id="dc31" class="graf graf--p graf-after--pre">Currently, as we are not running any applications at <code class="markup--code markup--p-code">http://localhost:8088</code> So, the API call will fail 2 times. In the console, you can see the logs as below:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="ddb3" id="ddb3" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-number">2023-11-01 12:03:55.994  </span><span class="hljs-string">INFO</span> <span class="hljs-number">9337</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">0</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-01T12:03:55.994537005</span><br /><span class="hljs-number">2023-11-01 12:03:56.009  </span><span class="hljs-string">INFO</span> <span class="hljs-number">9337</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-01 12:03:56.009  </span><span class="hljs-string">INFO</span> <span class="hljs-number">9337</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-01 12:03:58.010  </span><span class="hljs-string">INFO</span> <span class="hljs-number">9337</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">1</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-01T12:03:58.010479422</span><br /><span class="hljs-number">2023-11-01 12:03:58.013  </span><span class="hljs-string">INFO</span> <span class="hljs-number">9337</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-01 12:03:58.013  </span><span class="hljs-string">INFO</span> <span class="hljs-number">9337</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-01 12:03:58.017  </span><span class="hljs-string">INFO</span> <span class="hljs-number">9337</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">ResourceAccessException</span> <span class="hljs-string">recovered</span> <span class="hljs-string">at:2023-11-01T12:03:58.016871183</span><br /><span class="hljs-number">2023-11-01 12:03:58.018  </span><span class="hljs-string">INFO</span> <span class="hljs-number">9337</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.controller.MainController          :</span> <span class="hljs-string">CouldNotCallAPI</span></span></pre><p name="0c71" id="0c71" class="graf graf--p graf-after--pre">When a service is running at<code class="markup--code markup--p-code">http://localhost:8088</code>, console logs will be:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="c5ac" id="c5ac" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-number">2023-11-05 19:33:17.780  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6512</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">0</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-05T19:33:17.780550631</span><br /><span class="hljs-number">2023-11-05 19:33:18.145  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6512</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.controller.MainController          :</span> <span class="hljs-string">calledAPI</span></span></pre><p name="35f6" id="35f6" class="graf graf--p graf-after--pre">In the above example, we are waiting for 2000 millisecond intervals between each retry. We can make this delay exponential by customizing the attribute values of <code class="markup--code markup--p-code">@BackOff</code> annotation. For example,</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="less" name="6c25" id="6c25" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">    <span class="hljs-variable">@Retryable</span>(retryFor = {ConnectException.class, ArithmeticException.class, ResourceAccessException.class}, maxAttempts = <span class="hljs-number">8</span>,<br />            backoff = <span class="hljs-variable">@Backoff</span>(delay = <span class="hljs-number">2000</span>,<br />            multiplier = <span class="hljs-number">2</span>,<br />            maxDelay = <span class="hljs-number">12000</span>))</span></pre><p name="acb2" id="acb2" class="graf graf--p graf-after--pre">If we use the above configurations, it will attempt retry 8 times and will</p><ul class="postList"><li name="5faa" id="5faa" class="graf graf--li graf-after--p">wait for 2000 milliseconds for retry 1 after 1st invocation (retry 0)</li><li name="49b8" id="49b8" class="graf graf--li graf-after--li">wait for 4000 milliseconds (2*multiplier) for retry 2</li><li name="3521" id="3521" class="graf graf--li graf-after--li">wait for 8000 milliseconds (4*multiplier) for retry 3</li><li name="2b36" id="2b36" class="graf graf--li graf-after--li">wait for 12000 milliseconds (8*multiplier) for retry 4</li><li name="b622" id="b622" class="graf graf--li graf-after--li">wait for 12000 milliseconds for retry 5 —because maxDealy is set to 12000 milliseconds</li><li name="f289" id="f289" class="graf graf--li graf-after--li">wait for 12000 milliseconds for retry 6 — because maxDealy is set to 12000 milliseconds and so on.</li></ul><p name="5ced" id="5ced" class="graf graf--p graf-after--li">In console logs, you can observe the delay:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="3b26" id="3b26" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-number">2023-11-27 13:04:58.551  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">0</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-27T13:04:58.550903017</span><br /><span class="hljs-number">2023-11-27 13:04:58.568  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-27 13:04:58.568  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-27 13:05:00.570  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">1</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-27T13:05:00.570519633</span><br /><span class="hljs-number">2023-11-27 13:05:00.573  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-27 13:05:00.573  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-27 13:05:04.574  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">2</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-27T13:05:04.574349442</span><br /><span class="hljs-number">2023-11-27 13:05:04.575  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-27 13:05:04.575  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-27 13:05:12.576  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">3</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-27T13:05:12.576133331</span><br /><span class="hljs-number">2023-11-27 13:05:12.578  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-27 13:05:12.579  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-27 13:05:24.580  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">4</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-27T13:05:24.580295144</span><br /><span class="hljs-number">2023-11-27 13:05:24.583  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-27 13:05:24.584  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-27 13:05:36.585  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">5</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-27T13:05:36.585234745</span><br /><span class="hljs-number">2023-11-27 13:05:36.588  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-27 13:05:36.588  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-27 13:05:48.590  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">6</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-27T13:05:48.589973664</span><br /><span class="hljs-number">2023-11-27 13:05:48.592  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-27 13:05:48.593  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-27 13:06:00.594  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                : Retry Number :</span> <span class="hljs-number">7</span> <span class="hljs-string">at</span> <span class="hljs-string">time:2023-11-27T13:06:00.594747757</span><br /><span class="hljs-number">2023-11-27 13:06:00.596  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">other</span> <span class="hljs-string">exception</span> <span class="hljs-string">occurred.</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">on</span> <span class="hljs-string">GET</span> <span class="hljs-string">request</span> <span class="hljs-string">for</span> <span class="hljs-attr">&quot;http://localhost:8088/students&quot;:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused;</span> <span class="hljs-attr">nested exception is java.net.ConnectException:</span> <span class="hljs-string">Connection</span> <span class="hljs-string">refused</span><br /><span class="hljs-number">2023-11-27 13:06:00.596  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">throwing</span> <span class="hljs-string">resourceAccessException</span><br /><span class="hljs-number">2023-11-27 13:06:00.597  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.service.MainService                :</span> <span class="hljs-string">ResourceAccessException</span> <span class="hljs-string">recovered</span> <span class="hljs-string">at:2023-11-27T13:06:00.597317051</span><br /><span class="hljs-number">2023-11-27 13:06:00.597  </span><span class="hljs-string">INFO</span> <span class="hljs-number">6937</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-1</span>] <span class="hljs-attr">c.e.s.controller.MainController          :</span> <span class="hljs-string">CouldNotCallAPI</span></span></pre><blockquote name="e01c" id="e01c" class="graf graf--blockquote graf-after--pre graf--trailing">More details on <code class="markup--code markup--blockquote-code">@Backoff</code> is available <a href="https://docs.spring.io/spring-retry/docs/api/current/org/springframework/retry/annotation/Backoff.html#:~:text=Only%20the%20delay%28%29%20set,up%20to%20the%20maximum%20value" data-href="https://docs.spring.io/spring-retry/docs/api/current/org/springframework/retry/annotation/Backoff.html#:~:text=Only%20the%20delay()%20set,up%20to%20the%20maximum%20value" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">here</a>.</blockquote></div></div></section><section name="f472" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="b876" id="b876" class="graf graf--p graf--leading"><strong class="markup--strong markup--p-strong">Using RetryTemplate:</strong></p><p name="4599" id="4599" class="graf graf--p graf-after--p">Spring provides <code class="markup--code markup--p-code">RetryTemplate</code> using which we can have all retry configurations in one place.</p><p name="cadb" id="cadb" class="graf graf--p graf-after--p">Create a bean of <code class="markup--code markup--p-code">RetryTemplate</code> with required values:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="scss" name="b7f1" id="b7f1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">    <span class="hljs-keyword">@Bean</span><br />    public RetryTemplate getRetryTemplate() {<br />        return RetryTemplate<span class="hljs-selector-class">.builder</span>()<br />                <span class="hljs-selector-class">.maxAttempts</span>(<span class="hljs-number">2</span>)<br />                <span class="hljs-selector-class">.fixedBackoff</span>(<span class="hljs-number">1000</span>)<br />                <span class="hljs-selector-class">.retryOn</span>(ResourceAccessException.class)<br />                <span class="hljs-selector-class">.build</span>();<br />    }</span></pre><p name="44e2" id="44e2" class="graf graf--p graf-after--pre">Using the above bean, the method will be retried for exception<code class="markup--code markup--p-code">ResourceAccessException</code> a maximum of two times with a 1000 millisecond delay between each interval.</p><p name="c936" id="c936" class="graf graf--p graf-after--p">The next step is to include retryable code inside <code class="markup--code markup--p-code">RetryTemplate.execute()</code> method.</p><p name="17e4" id="17e4" class="graf graf--p graf-after--p">Here, we are providing <code class="markup--code markup--p-code">RetryCallback&lt;T, E&gt;</code> as the first parameter (code to be retried). The recovery part can be provided as a second parameter — <code class="markup--code markup--p-code">RecoveryCallback&lt;T&gt;</code> (code to recover).</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="typescript" name="0a3a" id="0a3a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">testAPIService</span>(<span class="hljs-title class_">String</span> arg1, <span class="hljs-title class_">Double</span> arg2) throws <span class="hljs-title class_">URISyntaxException</span>, <span class="hljs-title class_">ConnectException</span> {<br />        <span class="hljs-keyword">return</span> retryTemplate.<span class="hljs-title function_">execute</span>(ctx -&gt; {<br />            logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;inside SecondService. Retrying count: &quot;</span>+ctx.<span class="hljs-title function_">getRetryCount</span>()+<span class="hljs-string">&quot; at time: &quot;</span>+ <span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());<br />            <span class="hljs-title class_">RequestEntity</span>&lt;<span class="hljs-title class_">Object</span>&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestEntity</span>&lt;&gt;(<span class="hljs-title class_">HttpMethod</span>.<span class="hljs-property">GET</span>, <span class="hljs-keyword">new</span> <span class="hljs-title function_">URI</span>(<span class="hljs-string">&quot;http://localhost:8088/students&quot;</span>));<br />            restTemplate.<span class="hljs-title function_">exchange</span>(request, <span class="hljs-title class_">String</span>.<span class="hljs-property">class</span>);<br />            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;calledAPIInsideRetryTemplate&quot;</span>;<br />        }, (retryContext) -&gt; {<br />                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CouldNotCallAPIInsideRetryTemplate&quot;</span>;<br />        });<br />    }</span></pre><p name="aabf" id="aabf" class="graf graf--p graf-after--pre">The <code class="markup--code markup--p-code">execute()</code> method has different signatures. More details can be found in the <a href="https://docs.spring.io/spring-retry/docs/api/current/org/springframework/retry/support/RetryTemplate.html" data-href="https://docs.spring.io/spring-retry/docs/api/current/org/springframework/retry/support/RetryTemplate.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">RetryTemplate</a>.</p><p name="c199" id="c199" class="graf graf--p graf-after--p">In case of failure, you will see the console logs something like this:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="4bae" id="4bae" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-number">2023-11-05 19:45:03.660  </span><span class="hljs-string">INFO</span> <span class="hljs-number">7218</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-4</span>] <span class="hljs-attr">c.e.s.service.SecondService              : inside SecondService. Retrying count: 0 at time:</span> <span class="hljs-number">2023-11-05T19:45:03.660438770</span><br /><span class="hljs-number">2023-11-05 19:45:04.665  </span><span class="hljs-string">INFO</span> <span class="hljs-number">7218</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-4</span>] <span class="hljs-attr">c.e.s.service.SecondService              : inside SecondService. Retrying count: 1 at time:</span> <span class="hljs-number">2023-11-05T19:45:04.665648760</span><br /><span class="hljs-number">2023-11-05 19:45:04.668  </span><span class="hljs-string">INFO</span> <span class="hljs-number">7218</span> <span class="hljs-string">---</span> [<span class="hljs-string">nio-8080-exec-4</span>] <span class="hljs-attr">c.e.s.controller.MainController          :</span> <span class="hljs-string">CouldNotCallAPIInsideRetryTemplate</span></span></pre><p name="2c7f" id="2c7f" class="graf graf--p graf-after--pre">To customize backoff values, we can provide a <code class="markup--code markup--p-code">BackOffPolicy</code> in <code class="markup--code markup--p-code">RetryTemplate</code> bean:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="java" name="a639" id="a639" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">    <span class="hljs-meta">@Bean</span><br />    <span class="hljs-keyword">public</span> RetryTemplate <span class="hljs-title function_">getRetryTemplate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {<br />        <span class="hljs-type">ExponentialBackOffPolicy</span> <span class="hljs-variable">backOffPolicy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExponentialBackOffPolicy</span>();<br />        backOffPolicy.setMultiplier(<span class="hljs-number">2</span>);<br />        backOffPolicy.setMaxInterval(<span class="hljs-number">12000</span>);<br />        backOffPolicy.setInitialInterval(<span class="hljs-number">2000</span>);<br /><br />        <span class="hljs-keyword">return</span> RetryTemplate.builder()<br />        .maxAttempts(<span class="hljs-number">8</span>)<br />        .customBackoff(backOffPolicy)<br />        .retryOn(ResourceAccessException.class)<br />        .withListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultListenerSupport</span>())<br />        .build();<br />    }</span></pre><p name="f63a" id="f63a" class="graf graf--p graf-after--pre graf--trailing">The results will be similar to the above.</p></div></div></section><section name="6019" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="b4da" id="b4da" class="graf graf--p graf--leading"><strong class="markup--strong markup--p-strong">Listeners</strong></p><p name="1777" id="1777" class="graf graf--p graf-after--p">We can intercept each retry call using listeners. To make use of this, create a class that extends <code class="markup--code markup--p-code">MethodInvocationRetryListenerSupport</code>:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="java" name="c45a" id="c45a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">package</span> com.example.springretryoverview.listener;<br /><br /><span class="hljs-keyword">import</span> org.slf4j.Logger;<br /><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br /><span class="hljs-keyword">import</span> org.springframework.retry.RetryCallback;<br /><span class="hljs-keyword">import</span> org.springframework.retry.RetryContext;<br /><span class="hljs-keyword">import</span> org.springframework.retry.listener.MethodInvocationRetryListenerSupport;<br /><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br /><br /><br /><span class="hljs-meta">@Component</span><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultListenerSupport</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MethodInvocationRetryListenerSupport</span> {<br />    <br />    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(DefaultListenerSupport.class);<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-keyword">public</span> &lt;T, E <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">(RetryContext context,<br />                                               RetryCallback&lt;T, E&gt; callback, Throwable throwable)</span> {<br />        logger.info(<span class="hljs-string">&quot;onClose: completed configured number of retries. &quot;</span>);<br />        <span class="hljs-built_in">super</span>.close(context, callback, throwable);<br />    }<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-keyword">public</span> &lt;T, E <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(RetryContext context,<br />                                                 RetryCallback&lt;T, E&gt; callback, Throwable throwable)</span> {<br />        logger.info(<span class="hljs-string">&quot;onError: Error occurred during retry &quot;</span>+context.getRetryCount());<br />        <span class="hljs-built_in">super</span>.onError(context, callback, throwable);<br />    }<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-keyword">public</span> &lt;T, E <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">open</span><span class="hljs-params">(RetryContext context,<br />                                                 RetryCallback&lt;T, E&gt; callback)</span> {<br />        logger.info(<span class="hljs-string">&quot;onOpen: staring retry now.&quot;</span>);<br />        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.open(context, callback);<br />    }<br />}</span></pre><ul class="postList"><li name="76f3" id="76f3" class="graf graf--li graf-after--pre"><em class="markup--em markup--li-em">onOpen(): </em>called on the first invocation to retry enabled method. It will be called always irrespective of failure/success.</li><li name="5b48" id="5b48" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">onError()</em>: called on each retry failure.</li><li name="7eef" id="7eef" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">onClose():</em> called on the last invocation of retry enabled method. It will be called always irrespective of failure/success.</li></ul><p name="88a7" id="88a7" class="graf graf--p graf-after--li">Register this listener in <code class="markup--code markup--p-code">RetryTemplate</code> bean:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="scss" name="e2f3" id="e2f3" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">    <span class="hljs-keyword">@Bean</span><br />    public RetryTemplate getRetryTemplate() {<br />        return RetryTemplate<span class="hljs-selector-class">.builder</span>()<br />        <span class="hljs-selector-class">.maxAttempts</span>(<span class="hljs-number">2</span>)<br />        <span class="hljs-selector-class">.fixedBackoff</span>(<span class="hljs-number">1000</span>)<br />        <span class="hljs-selector-class">.retryOn</span>(ResourceAccessException.class)<br />        <span class="hljs-selector-class">.withListener</span>(new DefaultListenerSupport())<br />        <span class="hljs-selector-class">.build</span>();<br />    }</span></pre><p name="8ffa" id="8ffa" class="graf graf--p graf-after--pre">In the console, you will see the logs as below:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="plaintext" name="a79d" id="a79d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">2023-11-01 12:06:08.708  INFO 9589 --- [nio-8080-exec-1] c.e.s.listener.DefaultListenerSupport    : onOpen: staring retry now.<br />2023-11-01 12:06:08.715  INFO 9589 --- [nio-8080-exec-1] c.e.s.service.SecondService              : inside SecondService. Retrying count: 0 at time: 2023-11-01T12:06:08.714985952<br />2023-11-01 12:06:08.733  INFO 9589 --- [nio-8080-exec-1] c.e.s.listener.DefaultListenerSupport    : onError: Error occurred during retry 1<br />2023-11-01 12:06:09.734  INFO 9589 --- [nio-8080-exec-1] c.e.s.service.SecondService              : inside SecondService. Retrying count: 1 at time: 2023-11-01T12:06:09.734525826<br />2023-11-01 12:06:09.737  INFO 9589 --- [nio-8080-exec-1] c.e.s.listener.DefaultListenerSupport    : onError: Error occurred during retry 2<br />2023-11-01 12:06:09.738  INFO 9589 --- [nio-8080-exec-1] c.e.s.listener.DefaultListenerSupport    : onClose: completed configured number of retries. <br />2023-11-01 12:06:09.739  INFO 9589 --- [nio-8080-exec-1] c.e.s.controller.MainController          : CouldNotCallAPIInsideRetryTemplate</span></pre><p name="df13" id="df13" class="graf graf--p graf-after--pre">The complete code is available <a href="https://github.com/oldfr/spring-retry-overview" data-href="https://github.com/oldfr/spring-retry-overview" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p><p name="a4f3" id="a4f3" class="graf graf--p graf-after--p graf--trailing">Thank you for reading. Happy exploring!!!</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@ankithahjpgowda" class="p-author h-card">Ankitha Gowda</a> on <a href="https://medium.com/p/6674b06a3235"><time class="dt-published" datetime="2023-11-27T11:01:09.999Z">November 27, 2023</time></a>.</p><p><a href="https://medium.com/@ankithahjpgowda/spring-retry-overview-6674b06a3235" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 9, 2025.</p></footer></article></body></html>